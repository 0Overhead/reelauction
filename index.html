<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudinary Test</title>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #0a0a0a;
            color: white;
        }
        .btn {
            background: #ff3d00;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 8px;
            display: none;
        }
        .result img {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }
        .form-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 8px;
        }
        textarea {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border-radius: 4px;
            border: 1px solid #333;
            background: #0a0a0a;
            color: white;
            min-height: 100px;
        }
        .submit-btn {
            background: #ffd700;
            color: #000;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Cloudinary Widget Test</h1>
    <p>Click the button to open camera and upload</p>
    
    <button class="btn" onclick="openCloudinary()">ðŸ“¸ Capture Photo/Video</button>
    
    <div class="result" id="result"></div>
    
    <div class="form-section" id="formSection">
        <h3>âœ“ Upload Successful!</h3>
        <label>Add Description:</label>
        <textarea id="description" placeholder="Describe your content..."></textarea>
        <button class="btn submit-btn" onclick="submitListing()">List on Auction</button>
    </div>
    
    <script>
        let uploadedData = null;
        
        function openCloudinary() {
            const widget = cloudinary.createUploadWidget({
                cloudName: 'dtfymlzzr',
                uploadPreset: 'pro_capture',
                sources: ['camera'],
                multiple: false,
                resourceType: 'auto',
                clientAllowedFormats: ['jpg', 'jpeg', 'png', 'mp4', 'webm', 'mov'],
                maxFileSize: 100000000,
                cropping: false,
                showSkipCropButton: true,
                styles: {
                    palette: {
                        window: "#1a1a1a",
                        windowBorder: "#ff3d00",
                        tabIcon: "#ffd700",
                        menuIcons: "#ffffff",
                        textDark: "#ffffff",
                        textLight: "#cccccc",
                        link: "#ff3d00",
                        action: "#ff3d00",
                        inactiveTabIcon: "#666666",
                        error: "#ff0000",
                        inProgress: "#ffd700",
                        complete: "#00ff88",
                        sourceBg: "#2a2a2a"
                    }
                },
                text: {
                    en: {
                        or: "",
                        menu: {
                            files: "Take Photo or Video"
                        },
                        local: {
                            browse: "Camera",
                            dd_title_single: "Take Photo or Video"
                        }
                    }
                }
            }, (error, result) => {
                if (error) {
                    console.error('Upload error:', error);
                    alert('Upload failed: ' + error.message);
                    return;
                }
                
                if (result && result.event === 'success') {
                    console.log('Upload success:', result.info);
                    handleUploadSuccess(result.info);
                }
            });
            
            widget.open();
        }
        
        function handleUploadSuccess(info) {
            uploadedData = info;
            
            // Show result
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>âœ“ Upload Successful!</h3>
                <p><strong>URL:</strong> ${info.secure_url}</p>
                <p><strong>Type:</strong> ${info.resource_type}</p>
                <p><strong>Size:</strong> ${Math.round(info.bytes / 1024)} KB</p>
                ${info.resource_type === 'image' 
                    ? `<img src="${info.secure_url}" alt="Uploaded">`
                    : `<video src="${info.secure_url}" controls style="max-width: 100%;"></video>`
                }
            `;
            
            // Show form
            document.getElementById('formSection').style.display = 'block';
            
            // Scroll to form
            document.getElementById('formSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function submitListing() {
            const description = document.getElementById('description').value.trim();
            
            if (!description) {
                alert('Please add a description');
                return;
            }
            
            alert(`SUCCESS! Would create auction with:
- Media: ${uploadedData.secure_url}
- Type: ${uploadedData.resource_type}
- Description: ${description}

In the real app, this would create the auction and show it in the feed!`);
            
            // Reset for next capture
            document.getElementById('description').value = '';
            document.getElementById('result').style.display = 'none';
            document.getElementById('formSection').style.display = 'none';
        }
    </script>
</body>
</html>
